<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-Ass">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo do Animal - Ganhe</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo da fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Aplica a fonte Inter (puxada pela CDN do Tailwind) */
        @import url('https://rsms.me/inter/inter.css');

        html {
            font-family: 'Inter', sans-serif;
        }

        /* Oculta views por padr√£o */
        .view {
            display: none;
        }

        /* Anima√ß√£o de giro do slot */
        @keyframes spin {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .slot-item-spinning {
            animation: spin 0.1s linear;
        }

        /* Anima√ß√£o de pulso para ganhos */
        @keyframes pulse-win {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 10px #facc15;
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px #fde047;
            }
        }

        .slot-item-win {
            animation: pulse-win 0.5s ease-in-out 3;
            background-color: rgba(250, 204, 21, 0.2);
            /* bg-yellow-400/20 */
        }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen">

  <!-- Navega√ß√£o Principal (vis√≠vel ap√≥s o login) -->
<nav id="navbar" class="bg-gray-800 p-2 sm:p-4 sticky top-0 z-50 shadow-lg hidden"> 
    <!-- MUDAN√áA: 'p-2' (menos padding no celular) e 'sm:p-4' (padding normal em telas maiores) -->

    <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
        <!-- 
        MUDAN√áAS AQUI:
        'flex-col': Faz os itens empilharem verticalmente no celular.
        'sm:flex-row': Faz os itens voltarem √† linha horizontal em telas 'sm' (small) ou maiores.
        'space-y-2': Adiciona espa√ßo vertical entre os itens quando est√£o empilhados.
        'sm:space-y-0': Remove o espa√ßo vertical em telas maiores.
        -->

        <!-- 1. Logo (Fica no topo) -->
        <div class="text-xl sm:text-2xl font-bold text-yellow-400"> 
            <!-- MUDAN√áA: 'text-xl' (texto menor no celular) e 'sm:text-2xl' (texto normal em telas maiores) -->
            Animal<span class="text-white">Jogo</span>
        </div>

        <!-- 2. Info do Usu√°rio (Movemos para o meio no celular) -->
        <div class="flex items-center space-x-3 order-2 sm:order-none">
            <!-- 
            MUDAN√áAS AQUI:
            'order-2': Muda a ordem, colocando este item em segundo lugar no celular.
            'sm:order-none': Reseta a ordem em telas maiores.
            -->
            <div id="user-info" class="text-sm flex items-center space-x-2 sm:items-start sm:flex-col sm:space-x-0 sm:items-end">
                <!-- 
                MUDAN√áAS AQUI (Para o 'Ol√°, Nome' e 'Saldo'):
                No celular: Coloca o nome (oculto) e o saldo lado a lado ('flex items-center space-x-2').
                Em telas maiores: Empilha ('sm:flex-col') e alinha √† direita ('sm:items-end').
                -->
                <div id="user-name" class="font-semibold hidden sm:block">
                    <!-- MUDAN√áA: 'hidden' (esconde "Ol√°, Nome" no celular) e 'sm:block' (mostra em telas maiores) -->
                </div>
                <div id="user-balance" class="text-yellow-400 font-bold">Saldo: R$0,00</div>
            </div>
            <button id="logout-button" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded-md text-sm font-medium">Sair</button>
        </div>

        <!-- 3. Links de Navega√ß√£o (Movemos para baixo no celular) -->
        <div class="flex items-center space-x-4 order-3 sm:order-none">
            <!-- 
            MUDAN√áAS AQUI:
            'order-3': Joga os links para o final da pilha no celular.
            'sm:order-none': Reseta a ordem em telas maiores.
            -->
            <button id="nav-home" class="hover:text-yellow-400">In√≠cio</button>
            <button id="nav-deposit" class="hover:text-yellow-400">Depositar</button>
            <button id="nav-withdraw" class="hover:text-yellow-400">Sacar</button>
        </div>

    </div>
</nav>

    <!-- Container Principal das Views -->
    <div class="container mx-auto p-4 md:p-8">

        <!-- View: Carregando -->
        <div id="loading-view" class="view flex flex-col items-center justify-center min-h-[80vh]">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-yellow-400"></div>
            <p class="mt-4 text-lg">Carregando...</p>
        </div>

        <!-- View: Login -->
        <div id="login-view" class="view flex items-center justify-center min-h-[80vh]">
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl text-center w-full max-w-md">
                <h1 class="text-3xl font-bold text-yellow-400 mb-6">Bem-vindo ao AnimalJogo</h1>
                <p class="text-gray-300 mb-8">Plataforma de ganhos exponenciais.</p>
                <button id="login-button"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition duration-200">
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48">
                        <path fill="#EA4335"
                            d="M24 9.5c3.54 0 6.71 1.22 9.21 3.61l6.88-6.88C35.8 2.5 30.2 0 24 0 14.62 0 6.51 5.3 2.56 13.22l8.35 6.78C12.7 13.45 18.02 9.5 24 9.5z">
                        </path>
                        <path fill="#4285F4"
                            d="M46.98 24.55c0-1.57-.15-3.09-.42-4.55H24v8.51h12.8c-.54 2.8-2.1 5.22-4.49 6.84l8.35 6.78c4.8-4.4 7.72-10.9 7.72-18.58z">
                        </path>
                        <path fill="#FBBC05"
                            d="M10.91 28.19C10.33 26.37 10 24.48 10 22.5s.33-3.87.91-5.69l-8.35-6.78C1.03 14.15 0 18.22 0 22.5s1.03 8.35 2.56 12.09l8.35-6.4z">
                        </path>
                        <path fill="#34A853"
                            d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-8.35-6.78c-2.15 1.45-4.92 2.3-8.04 2.3-6.17 0-11.42-4.1-13.29-9.7l-8.35 6.78C6.51 42.7 14.62 48 24 48z">
                        </path>
                        <path fill="none" d="M0 0h48v48H0z"></path>
                    </svg>
                    Entrar com Google
                </button>
            </div>
        </div>

        <!-- View: In√≠cio (Sele√ß√£o de Animal) -->
        <div id="home-view" class="view">
            <h2 class="text-3xl font-bold text-center mb-8">Escolha seu Animal</h2>
            <div id="animal-grid" class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <!-- Animais ser√£o inseridos pelo JS -->
            </div>
        </div>

        <!-- View: Jogo (Sorteio) -->
        <div id="game-view" class="view">
            <h2 id="game-title" class="text-4xl font-bold text-center mb-6 text-yellow-400"></h2>

            <!-- A Grade do Jogo -->
            <div class="flex justify-center mb-6">
                <div id="slot-grid" class="grid grid-cols-3 gap-4 bg-gray-800 p-6 rounded-lg shadow-inner">
                    <!-- 9 Itens do Sorteio -->
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                    <div
                        class="slot-item w-24 h-24 md:w-32 md:h-32 bg-gray-700 rounded-lg flex items-center justify-center text-5xl md:text-6xl border-4 border-gray-600">
                    </div>
                </div>
            </div>

            <!-- Mensagem de Resultado -->
            <div id="game-result-message" class="text-center text-2xl font-bold my-4 h-8"></div>

            <!-- Controles do Jogo -->
            <div class="flex flex-col items-center space-y-4">
                <div class="flex items-center space-x-4">
                    <button id="decrease-bet"
                        class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-2xl">-</button>
                    <div id="bet-amount-display"
                        class="text-2xl font-bold bg-gray-800 px-6 py-3 rounded-lg w-48 text-center">Aposta: R$1,00
                    </div>
                    <button id="increase-bet"
                        class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-2xl">+</button>
                </div>
                <button id="spin-button"
                    class="bg-gradient-to-r from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700 text-gray-900 font-bold py-4 px-20 rounded-lg text-2xl shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                    GIRAR
                </button>
            </div>
        </div>

        <!-- View: Dep√≥sito -->
        <div id="deposit-view" class="view">
            <div class="max-w-md mx-auto bg-gray-800 p-8 rounded-lg shadow-xl">
                <h2 class="text-3xl font-bold text-center mb-6 text-yellow-400">Depositar</h2>
                <p class="text-gray-300 text-center mb-4">O valor obrigat√≥rio do 1¬∫ dep√≥sito √© de R$20,00</p>

                <div class="mb-4">
                    <label for="deposit-amount" class="block text-sm font-medium text-gray-300 mb-2">Valor do Dep√≥sito
                        (R$)</label>
                    <input type="number" id="deposit-amount"
                        class="w-full bg-gray-600 text-gray-300 p-3 rounded-lg border border-gray-500 cursor-not-allowed"
                        value="10" placeholder="R$20,00" disabled>
                </div>
            </div>


            <div id="deposit-message" class="text-red-400 text-center h-5 mt-4"></div>
            <p class="text-gray-300 text-center mb-4">Para fazer um dep√≥sito, copie a chave PIX abaixo e cole no seu
                banco.</p>
            <div class="bg-gray-700 p-4 rounded-lg mb-4">
                <p class="text-sm text-gray-400 mb-2">Chave PIX:</p>
                <div class="flex justify-between items-center">
                    <span id="pix-key-display" class="text-lg font-mono"
                        data-full-key="00020126580014BR.GOV.BCB.PIX01366c7bc477-9ade-4ba9-9177-000d5b9e2f87520400005303986540520.005802BR5925Alessandro Leonello Ribei6009SAO PAULO62140510zOlnFZEmDv630473D3">
                        00020126580014...
                    </span>
                    <button id="copy-pix-button"
                        class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-lg">Copiar</button>

                </div>

            </div>
            <button id="confirm-deposit-button"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
                Fazer Dep√≥sito
            </button>
            <div id="copy-message" class="text-green-400 text-center h-5"></div>

            <p class="text-gray-400 text-sm text-center mt-4">Ap√≥s o pagamento, seu saldo ser√° atualizado
                (automaticamente).</p>
        </div>
    </div>

    <!-- View: Saque -->
    <div id="withdraw-view" class="view">
        <div class="max-w-md mx-auto bg-gray-800 p-8 rounded-lg shadow-xl">
            <h2 class="text-3xl font-bold text-center mb-6 text-yellow-400">Sacar</h2>
            <form id="withdraw-form">
                <div class="mb-4">
                    <label for="withdraw-key" class="block text-sm font-medium text-gray-300 mb-2">Sua Chave PIX</label>
                    <input type="text" id="withdraw-key"
                        class="w-full bg-gray-700 text-white p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                        placeholder="email@provedor.com ou CPF">
                </div>
                <div class="mb-6">
                    <label for="withdraw-amount" class="block text-sm font-medium text-gray-300 mb-2">Valor (R$)</label>
                    <input type="number" id="withdraw-amount"
                        class="w-full bg-gray-700 text-white p-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                        placeholder="100,00">
                </div>
                <button id="withdraw-button" type="submit"
                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                    Solicitar Saque
                </button>
            </form>
            <div id="withdraw-message" class="text-red-400 text-center mt-6 text-lg font-semibold h-5"></div>
        </div>
    </div>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            setDoc,
            getDoc,
            onSnapshot,
            updateDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configura√ß√£o do Firebase (VARI√ÅVEIS GLOBAIS FORNECIDAS) ---

        const firebaseConfig = {
            apiKey: "AIzaSyD6Y6TZe33813Fyt6RQP2FX-F1ojQhijsg",
            authDomain: "tigrinho-e6b2d.firebaseapp.com",
            projectId: "tigrinho-e6b2d",
            storageBucket: "tigrinho-e6b2d.firebasestorage.app",
            messagingSenderId: "883179406282",
            appId: "1:883179406282:web:f6e1654a53b516ef034533"
        };



        // Define um ID para este aplicativo
        const appId = 'jogo-animal-simulador'; // Pode ser qualquer nome

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Defini√ß√µes do Jogo ---
        const animals = {
            tiger: { name: "Tigre", icon: "üêÖ", theme: ["üêÖ", "üíé", "üí∞", "7Ô∏è‚É£", "üîî"], color: "text-orange-400" },
            lion: { name: "Le√£o", icon: "ü¶Å", theme: ["ü¶Å", "üëë", "ü•©", "7Ô∏è‚É£", "ü™ô"], color: "text-yellow-500" },
            elephant: { name: "Elefante", icon: "üêò", theme: ["üêò", "ü•ú", "üåø", "7Ô∏è‚É£", "üíß"], color: "text-gray-400" },
            rabbit: { name: "Coelho", icon: "üêá", theme: ["üêá", "ü•ï", "üçÄ", "7Ô∏è‚É£", "üçì"], color: "text-pink-400" }
        };

        // --- Estado Global do Aplicativo ---
        let currentUserId = null;
        let currentUserData = null;
        let unsubscribeProfile = null; // Para limpar o listener do onSnapshot
        let currentBet = 1;
        const betStep = 1;
        const maxBet = 50;
        const minBet = 1;
        let currentGameTheme = [];
        let isSpinning = false;

        // --- Seletores DOM ---
        const views = document.querySelectorAll('.view');
        const navbar = document.getElementById('navbar');
        const loadingView = document.getElementById('loading-view');
        const loginView = document.getElementById('login-view');
        const homeView = document.getElementById('home-view');
        const gameView = document.getElementById('game-view');
        const depositView = document.getElementById('deposit-view');
        const withdrawView = document.getElementById('withdraw-view');

        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const navHome = document.getElementById('nav-home');
        const navDeposit = document.getElementById('nav-deposit');
        const navWithdraw = document.getElementById('nav-withdraw');

        const userNameDisplay = document.getElementById('user-name');
        const userBalanceDisplay = document.getElementById('user-balance');
        const animalGrid = document.getElementById('animal-grid');

        const gameTitle = document.getElementById('game-title');
        const slotGrid = document.getElementById('slot-grid');
        const slotItems = document.querySelectorAll('.slot-item');
        const betAmountDisplay = document.getElementById('bet-amount-display');
        const decreaseBetButton = document.getElementById('decrease-bet');
        const increaseBetButton = document.getElementById('increase-bet');
        const spinButton = document.getElementById('spin-button');
        const gameResultMessage = document.getElementById('game-result-message');

        const pixKeyDisplay = document.getElementById('pix-key-display');
        const copyPixButton = document.getElementById('copy-pix-button');
        const copyMessage = document.getElementById('copy-message');

        const depositAmountInput = document.getElementById('deposit-amount');
        const confirmDepositButton = document.getElementById('confirm-deposit-button');
        const depositMessage = document.getElementById('deposit-message');

        const withdrawForm = document.getElementById('withdraw-form');
        const withdrawMessage = document.getElementById('withdraw-message');

        // --- Fun√ß√µes de Navega√ß√£o ---
        function showView(viewId) {
            views.forEach(view => view.style.display = 'none');
            const viewToShow = document.getElementById(viewId);
            if (viewToShow) {
                viewToShow.style.display = 'block';
            }

            // Mostra/Esconde a navbar
            if (viewId === 'login-view' || viewId === 'loading-view') {
                navbar.style.display = 'none';
            } else {
                navbar.style.display = 'block';
            }
            // ADICIONE ESTE BLOCO NO FINAL DA FUN√á√ÉO:
            if (viewId === 'deposit-view') {
                depositAmountInput.value = '';
                depositMessage.textContent = '';
                copyMessage.textContent = '';
                confirmDepositButton.disabled = true; // Bot√£o come√ßa desabilitado
            }
        }

        // --- Fun√ß√µes de Formata√ß√£o ---
        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // --- Fun√ß√µes de UI ---
        function updateUI() {
            if (currentUserData) {
                userNameDisplay.textContent = `Ol√°, ${currentUserData.displayName.split(' ')[0]}`;
                userBalanceDisplay.textContent = `Saldo: ${formatCurrency(currentUserData.balance)}`;
            }
        }

        function populateAnimalGrid() {
            animalGrid.innerHTML = ''; // Limpa a grade
            for (const [key, animal] of Object.entries(animals)) {
                const card = document.createElement('div');
                card.className = `animal-card bg-gray-800 rounded-lg shadow-lg p-6 text-center cursor-pointer transform transition hover:scale-105 hover:shadow-yellow-500/30 border-2 border-transparent hover:border-yellow-400`;
                card.dataset.animal = key;
                card.innerHTML = `
                    <div class="text-7xl mb-4">${animal.icon}</div>
                    <h3 class="text-2xl font-bold ${animal.color}">${animal.name}</h3>
                `;
                animalGrid.appendChild(card);
            }
        }

        function updateBetDisplay() {
            betAmountDisplay.textContent = `Aposta: ${formatCurrency(currentBet)}`;
            decreaseBetButton.disabled = (currentBet <= minBet);
            increaseBetButton.disabled = (currentBet >= maxBet);
        }

        // --- L√≥gica de Autentica√ß√£o ---

        // Listener de estado de autentica√ß√£o
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usu√°rio est√° logado
                currentUserId = user.uid;
                console.log("Usu√°rio logado:", currentUserId);
                // Configura o listener do perfil
                setupProfileListener(currentUserId, user);
                // Preenche a grade de animais
                populateAnimalGrid();
                // Mostra a tela inicial
                showView('home-view');
            } else {
                // Usu√°rio est√° deslogado
                console.log("Usu√°rio deslogado.");
                currentUserId = null;
                currentUserData = null;
                // Para o listener anterior se existir
                if (unsubscribeProfile) {
                    unsubscribeProfile();
                    unsubscribeProfile = null;
                }
                showView('login-view');
            }
        });

        // Bot√£o de Login
        loginButton.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                // O onAuthStateChanged vai cuidar da transi√ß√£o de tela
            } catch (error) {
                console.error("Erro ao fazer login com Google:", error);
            }
        });

        // Bot√£o de Logout
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                // O onAuthStateChanged vai cuidar da transi√ß√£o de tela
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        });

        // --- L√≥gica do Firestore ---

        // Caminho do documento de perfil (privado do usu√°rio)
        function getProfileDocRef(userId) {
            return doc(db, 'artifacts', appId, 'users', userId, 'userData', 'main');
        }

        // Configura o listener para o perfil do usu√°rio
        function setupProfileListener(userId, user) {
            if (unsubscribeProfile) unsubscribeProfile(); // Cancela listener antigo

            const docRef = getProfileDocRef(userId);

            unsubscribeProfile = onSnapshot(docRef, async (docSnap) => {
                if (docSnap.exists()) {
                    // Documento existe, atualiza dados locais
                    currentUserData = docSnap.data();
                    console.log("Dados do usu√°rio atualizados:", currentUserData);
                    updateUI(); // Atualiza a UI com novos dados (ex: saldo)
                } else {
                    // Documento n√£o existe, cria um novo perfil
                    console.log("Perfil n√£o encontrado, criando um novo...");
                    const newUserProfile = {
                        displayName: user.displayName || "Jogador",
                        email: user.email,
                        balance: 0.00, // Saldo inicial de R$ 100,00
                        createdAt: serverTimestamp()
                    };
                    await setDoc(docRef, newUserProfile);
                    // O onSnapshot vai pegar essa mudan√ßa e chamar updateUI()
                }
            }, (error) => {
                console.error("Erro ao escutar perfil:", error);
            });
        }

        // Fun√ß√£o para atualizar o saldo (de forma segura)
        async function updateUserBalance(newBalance) {
            if (!currentUserId) return;
            const docRef = getProfileDocRef(currentUserId);
            try {
                await updateDoc(docRef, { balance: newBalance });
                // O onSnapshot atualizar√° o 'currentUserData' e a 'updateUI' localmente
            } catch (error) {
                console.error("Erro ao atualizar saldo:", error);
            }
        }

        // --- Navega√ß√£o da Navbar ---
        navHome.addEventListener('click', () => showView('home-view'));
        navDeposit.addEventListener('click', () => showView('deposit-view'));
        navWithdraw.addEventListener('click', () => showView('withdraw-view'));

        // --- L√≥gica da Tela Inicial (Sele√ß√£o) ---
        animalGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.animal-card');
            if (card) {
                const animalKey = card.dataset.animal;
                startGame(animalKey);
            }
        });

        // --- L√≥gica da Tela do Jogo ---
        function startGame(animalKey) {
            const animal = animals[animalKey];
            currentGameTheme = animal.theme;
            gameTitle.innerHTML = `<span class="mr-4">${animal.icon}</span> Jogo do ${animal.name}`;
            gameTitle.className = `text-4xl font-bold text-center mb-6 ${animal.color}`;

            // Reseta a grade
            slotItems.forEach(item => {
                item.textContent = '‚ùì';
                item.classList.remove('slot-item-win');
            });
            gameResultMessage.textContent = '';

            currentBet = minBet;
            updateBetDisplay();
            showView('game-view');
        }

        // Controles de Aposta
        decreaseBetButton.addEventListener('click', () => {
            currentBet = Math.max(minBet, currentBet - betStep);
            updateBetDisplay();
        });

        increaseBetButton.addEventListener('click', () => {
            currentBet = Math.min(maxBet, currentBet + betStep);
            updateBetDisplay();
        });

        // Bot√£o de Girar
        spinButton.addEventListener('click', handleSpin);

        async function handleSpin() {
            if (isSpinning) return;

            if (currentUserData.balance < currentBet) {
                gameResultMessage.textContent = "Saldo insuficiente!";
                gameResultMessage.className = "text-center text-2xl font-bold my-4 h-8 text-red-500";
                return;
            }

            isSpinning = true;
            spinButton.disabled = true;
            gameResultMessage.textContent = 'Girando...';
            gameResultMessage.className = "text-center text-2xl font-bold my-4 h-8 text-gray-400";
            slotItems.forEach(item => item.classList.remove('slot-item-win'));

            // 1. Debita a aposta
            const balanceAfterBet = currentUserData.balance - currentBet;
            await updateUserBalance(balanceAfterBet);

            // 2. Anima√ß√£o de giro
            const spinInterval = setInterval(() => {
                slotItems.forEach(item => {
                    item.textContent = currentGameTheme[Math.floor(Math.random() * currentGameTheme.length)];
                    item.classList.add('slot-item-spinning');
                });
                // Remove a classe de anima√ß√£o logo ap√≥s para o pr√≥ximo frame
                setTimeout(() => slotItems.forEach(item => item.classList.remove('slot-item-spinning')), 100);
            }, 100);

            // 3. Para a anima√ß√£o e calcula o resultado
            setTimeout(async () => {
                clearInterval(spinInterval);

                // 4. Gera o resultado final
                const grid = [];
                const counts = {};

                slotItems.forEach(item => {
                    const randomItem = currentGameTheme[Math.floor(Math.random() * currentGameTheme.length)];
                    item.textContent = randomItem;
                    grid.push(randomItem);
                    // Conta os itens
                    counts[randomItem] = (counts[randomItem] || 0) + 1;
                });

                // 5. Calcula os ganhos
                let winnings = 0;
                let winningItem = null;
                for (const [item, count] of Object.entries(counts)) {
                    if (count === 3) winnings = currentBet * 1.5;
                    if (count === 4) winnings = currentBet * 2;
                    if (count === 5) winnings = currentBet * 3;
                    if (count === 6) winnings = currentBet * 5;
                    if (count === 7) winnings = currentBet * 10;
                    if (count === 8) winnings = currentBet * 20;
                    if (count === 9) winnings = currentBet * 50; // Jackpot

                    if (winnings > 0) winningItem = item;
                }

                // 6. Mostra o resultado e paga
                if (winnings > 0) {
                    gameResultMessage.textContent = `Voc√™ ganhou ${formatCurrency(winnings)}!`;
                    gameResultMessage.className = "text-center text-2xl font-bold my-4 h-8 text-yellow-400";

                    // Adiciona o pr√™mio ao saldo
                    const finalBalance = balanceAfterBet + winnings;
                    await updateUserBalance(finalBalance);

                    // Destaca os itens ganhadores
                    slotItems.forEach(item => {
                        if (item.textContent === winningItem) {
                            item.classList.add('slot-item-win');
                        }
                    });

                } else {
                    gameResultMessage.textContent = "N√£o foi dessa vez.";
                    gameResultMessage.className = "text-center text-2xl font-bold my-4 h-8 text-gray-500";
                }

                isSpinning = false;
                spinButton.disabled = false;
            }, 1500); // Dura√ß√£o total do giro: 1.5 segundos
        }

        // --- L√≥gica de Dep√≥sito ---

        // Fun√ß√£o para copiar (usa a API moderna, mas com fallback)
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopyMessage(true);
                }, () => {
                    // Fallback para document.execCommand
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        // Fallback para o 'copy'
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; // Evita rolagem
            textArea.style.top = "0";
            textArea.style.left = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                showCopyMessage(successful);
            } catch (err) {
                showCopyMessage(false);
            }
            document.body.removeChild(textArea);
        }

        function showCopyMessage(success) {
            if (success) {
                copyMessage.textContent = "Chave PIX copiada!";
                confirmDepositButton.disabled = false; // <-- ADICIONE ESTA LINHA
                setTimeout(() => { copyMessage.textContent = ''; }, 5000);

                // REMOVA A LINHA ABAIXO:
                // setTimeout(simulateDeposit, 5000); 
            } else {
               
                copyMessage.classList.add('text-red-500');
                setTimeout(() => {
                    copyMessage.textContent = '';
                    copyMessage.classList.remove('text-red-500');
                }, 2000);
            }
        }

        // SUBSTITUA A FUN√á√ÉO ANTIGA POR ESTA:
        async function simulateDeposit(amount) {
            // Adiciona valida√ß√£o
            if (!currentUserData || !amount || amount <= 0) return;

            // Usa o 'amount' do par√¢metro
            const depositAmount = parseFloat(amount); // Garante que √© um n√∫mero
            if (isNaN(depositAmount)) return;

            const newBalance = currentUserData.balance + depositAmount;
            await updateUserBalance(newBalance);

            // Alerta o usu√°rio com o valor correto
            alert(`Dep√≥sito:\n+ ${formatCurrency(depositAmount)} adicionado ao seu saldo!`);

            showView('home-view'); // Volta para o in√≠cio
        }
       copyPixButton.addEventListener('click', () => {
    // Pega a chave completa guardada no atributo 'data-full-key'
    const fullKey = pixKeyDisplay.dataset.fullKey;
    
    // Manda copiar a chave completa, e n√£o o texto vis√≠vel
    copyToClipboard(fullKey);
});

        // ADICIONE ESTE NOVO LISTENER:
        confirmDepositButton.addEventListener('click', () => {
            const amount = parseFloat(depositAmountInput.value);

            // Valida√ß√£o do valor digitado
           /* if (isNaN(amount) || amount <= 0) {
                depositMessage.textContent = "Por favor, insira um valor v√°lido.";
                setTimeout(() => { depositMessage.textContent = ''; }, 3000);
                return;
            } */

            // Desabilita o bot√£o para evitar cliques duplos
            confirmDepositButton.disabled = true;
            confirmDepositButton.textContent = "Processando...";
             copyMessage.textContent = "Cole a chave Pix no seu banco para fazer o pagamento e aguarde!";
                showCopyMessage();

            // Simula o tempo de processamento
            setTimeout(() => {
                simulateDeposit(20); // Chama a simula√ß√£o com o valor
                // Reseta o bot√£o (embora a view v√° mudar, √© uma boa pr√°tica)
                confirmDepositButton.disabled = false;
                confirmDepositButton.textContent = "Fazer Dep√≥sito";
            }, 15000); // Simula 1.5s de processamento
        });

        // --- L√≥gica de Saque ---
        withdrawForm.addEventListener('submit', (e) => {
            e.preventDefault();
            withdrawMessage.textContent = "Para fazer um saque voc√™ precisa jogar mais 12 vezes";

            // Limpa a mensagem ap√≥s 3 segundos
            setTimeout(() => {
                withdrawMessage.textContent = '';
            }, 3000);
        });


        // --- Inicializa√ß√£o ---
        showView('loading-view'); // Come√ßa mostrando o loading

        // (O onAuthStateChanged ir√° eventualmente mudar para 'login' ou 'home')

    </script>
</body>

</html>